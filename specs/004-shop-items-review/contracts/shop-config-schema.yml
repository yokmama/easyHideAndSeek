# Shop Configuration Schema
# Version: 2.0
# Description: Defines the structure for shop.yml configuration file

# This is a JSON Schema represented in YAML format for better readability
# Use this to validate shop.yml configurations

$schema: "http://json-schema.org/draft-07/schema#"
title: "Hide and Seek Shop Configuration"
description: "Configuration schema for shop items, pricing, and restrictions"
type: object

required:
  - shop

properties:
  shop:
    type: object
    required:
      - version
      - categories
      - items
      - disguise-blocks

    properties:
      version:
        type: integer
        description: "Schema version number"
        minimum: 2
        example: 2

      # ===== CATEGORIES =====
      categories:
        type: object
        description: "Shop GUI categories for organizing items"
        patternProperties:
          "^[a-z0-9-]+$":
            type: object
            required:
              - name
              - icon
              - slot
            properties:
              name:
                type: string
                description: "Display name with color codes"
                pattern: "^(&[0-9a-fk-or]).+"
                example: "&eDisguise Blocks"

              icon:
                type: string
                description: "Material type for category icon"
                pattern: "^[A-Z_]+$"
                example: "GRASS_BLOCK"

              slot:
                type: integer
                description: "GUI slot position (0-53)"
                minimum: 0
                maximum: 53
                example: 0

              role-filter:
                type: string
                enum: ["HIDER", "SEEKER"]
                description: "Restrict category to specific role"

        examples:
          hider-disguise:
            name: "&eDisguise Blocks"
            icon: "GRASS_BLOCK"
            slot: 0

          seeker-tracking:
            name: "&cTracking Tools"
            icon: "COMPASS"
            slot: 0
            role-filter: "SEEKER"

      # ===== DISGUISE BLOCKS =====
      disguise-blocks:
        type: object
        description: "Camouflage-based pricing tiers for disguise blocks"
        required:
          - high-visibility
          - medium-visibility
          - low-visibility

        properties:
          high-visibility:
            $ref: "#/definitions/disguise-tier"
            description: "Free blocks that are easy to spot"

          medium-visibility:
            $ref: "#/definitions/disguise-tier"
            description: "Moderately priced blocks"

          low-visibility:
            $ref: "#/definitions/disguise-tier"
            description: "Expensive blocks that blend into environment"

      # ===== ITEMS =====
      items:
        type: object
        description: "Shop items available for purchase"
        patternProperties:
          "^[a-z0-9-]+$":
            $ref: "#/definitions/shop-item"

        examples:
          shadow-sprint:
            category: "hider-utility"
            material: "FEATHER"
            display-name: "&eShadow Sprint"
            lore:
              - "&720 seconds of speed boost"
              - "&7Can be used while visible"
            price: 350
            effect:
              type: "SPEED_BOOST"
              duration: 20
              intensity: 1.5
            restrictions:
              type: "PER_PLAYER"
              max-purchases: 2
              cooldown: 60
            role-filter: "HIDER"

      # ===== GLOBAL SETTINGS =====
      settings:
        type: object
        description: "Global shop settings"
        properties:
          enable-statistics:
            type: boolean
            default: true
            description: "Log purchase analytics"

          statistics-file:
            type: string
            default: "shop-stats.csv"
            description: "Analytics log filename"

          cache-gui:
            type: boolean
            default: true
            description: "Cache shop GUI inventories"

          cache-expiry-ms:
            type: integer
            default: 60000
            minimum: 1000
            description: "Cache TTL in milliseconds"

      # ===== ARENA OVERRIDES =====
      arena-overrides:
        type: object
        description: "Arena-specific shop configurations"
        patternProperties:
          "^[a-z0-9-]+$":
            $ref: "#/definitions/arena-shop-config"

# ===== DEFINITIONS =====
definitions:

  # Disguise Tier
  disguise-tier:
    type: object
    required:
      - price
      - blocks
    properties:
      price:
        type: integer
        minimum: 0
        description: "Base price for this tier"
        example: 100

      blocks:
        type: array
        items:
          type: string
          pattern: "^[A-Z_]+$"
        minItems: 1
        description: "List of Material types in this tier"
        examples:
          - ["STONE", "COBBLESTONE", "DIRT", "GRASS_BLOCK"]
          - ["MELON", "PUMPKIN", "GOLD_BLOCK"]

  # Shop Item
  shop-item:
    type: object
    required:
      - category
      - material
      - display-name
      - lore
      - price

    properties:
      category:
        type: string
        pattern: "^[a-z0-9-]+$"
        description: "Reference to category ID"
        example: "hider-utility"

      material:
        type: string
        pattern: "^[A-Z_]+$"
        description: "Bukkit Material type"
        example: "FEATHER"

      display-name:
        type: string
        pattern: "^(&[0-9a-fk-or]).+"
        description: "Display name with color codes"
        example: "&eShadow Sprint"

      lore:
        type: array
        items:
          type: string
        minItems: 1
        description: "Tooltip lines"
        example:
          - "&720 seconds of speed boost"
          - "&7Cost: 350 coins"

      slot:
        type: integer
        minimum: 0
        maximum: 53
        description: "GUI slot position (optional, auto-assigned if omitted)"

      price:
        type: integer
        minimum: 0
        description: "Cost in coins"
        example: 350

      # Effect configuration
      effect:
        type: object
        description: "Effect to apply on use"
        required:
          - type
          - duration
          - intensity
        properties:
          type:
            type: string
            enum:
              - "SPEED_BOOST"
              - "VISION_NIGHT"
              - "GLOW_DETECTOR"
              - "REACH_EXTENDER"
              - "SHADOW_SPRINT"
              - "DECOY_BLOCK"
              - "SECOND_CHANCE"
              - "TRACKER_COMPASS"
              - "AREA_SCAN"
              - "EAGLE_EYE"
              - "TRACKER_INSIGHT"
              - "CAPTURE_NET"
            description: "Effect type"

          duration:
            type: integer
            minimum: 1
            description: "Duration in seconds"
            example: 30

          intensity:
            type: number
            minimum: 0.1
            description: "Effect strength multiplier"
            example: 1.5

          metadata:
            type: object
            description: "Effect-specific configuration"
            additionalProperties: true

      # Restrictions
      restrictions:
        type: object
        description: "Purchase and usage restrictions"
        properties:
          type:
            type: string
            enum: ["PER_PLAYER", "PER_TEAM", "GLOBAL"]
            description: "Scope of restriction"
            example: "PER_PLAYER"

          max-purchases:
            type: integer
            minimum: 1
            description: "Maximum purchases allowed"
            example: 2

          cooldown:
            type: integer
            minimum: 1
            description: "Cooldown in seconds"
            example: 60

          reset-trigger:
            type: string
            enum: ["NEVER", "ON_USE", "ON_DEATH", "ON_PHASE_CHANGE", "ON_PURCHASE"]
            default: "NEVER"
            description: "When limit/cooldown resets"

      # Filters
      role-filter:
        type: string
        enum: ["HIDER", "SEEKER"]
        description: "Restrict to specific role"
        example: "HIDER"

      usage-restriction:
        type: string
        enum: ["ALWAYS", "IN_GAME_ONLY", "PREP_ONLY", "SEEK_ONLY"]
        default: "ALWAYS"
        description: "When item can be used"

      # Camouflage (for disguise items)
      camouflage-tier:
        type: string
        enum: ["HIGH_VISIBILITY", "MEDIUM_VISIBILITY", "LOW_VISIBILITY"]
        description: "Pricing tier (overrides price field)"

      camouflage-multiplier:
        type: number
        minimum: 0.0
        description: "Custom price multiplier for tier"
        example: 1.5

      # Analytics
      track-usage:
        type: boolean
        default: true
        description: "Include in usage statistics"

  # Arena Shop Config
  arena-shop-config:
    type: object
    properties:
      item-price-multiplier:
        type: number
        minimum: 0.1
        default: 1.0
        description: "Scale all item prices"
        example: 1.5

      disabled-items:
        type: array
        items:
          type: string
          pattern: "^[a-z0-9-]+$"
        description: "List of item IDs to disable"
        example: ["second-chance", "capture-net"]

      custom-items:
        type: object
        patternProperties:
          "^[a-z0-9-]+$":
            $ref: "#/definitions/shop-item"
        description: "Arena-specific custom items"

# ===== EXAMPLES =====
examples:
  - shop:
      version: 2

      categories:
        hider-disguise:
          name: "&eDisguise Blocks"
          icon: "GRASS_BLOCK"
          slot: 0
          role-filter: "HIDER"

        hider-utility:
          name: "&eUtility Items"
          icon: "ENDER_PEARL"
          slot: 1
          role-filter: "HIDER"

        seeker-tracking:
          name: "&cTracking Tools"
          icon: "COMPASS"
          slot: 0
          role-filter: "SEEKER"

      disguise-blocks:
        high-visibility:
          price: 0
          blocks:
            - "MELON"
            - "PUMPKIN"
            - "SPONGE"
            - "GOLD_BLOCK"
            - "DIAMOND_BLOCK"

        medium-visibility:
          price: 50
          blocks:
            - "OAK_LOG"
            - "BRICK"
            - "SANDSTONE"
            - "GRAVEL"

        low-visibility:
          price: 100
          blocks:
            - "STONE"
            - "COBBLESTONE"
            - "DIRT"
            - "GRASS_BLOCK"
            - "ANDESITE"

      items:
        shadow-sprint:
          category: "hider-utility"
          material: "FEATHER"
          display-name: "&eShadow Sprint"
          lore:
            - "&720 seconds of speed boost"
            - "&7Can be used while visible"
            - ""
            - "&7Cost: &6350 coins"
          price: 350
          effect:
            type: "SHADOW_SPRINT"
            duration: 20
            intensity: 1.5
          restrictions:
            type: "PER_PLAYER"
            max-purchases: 2
            cooldown: 60
            reset-trigger: "ON_USE"
          role-filter: "HIDER"

        tracker-compass:
          category: "seeker-tracking"
          material: "COMPASS"
          display-name: "&cTracker Compass"
          lore:
            - "&7Points to nearest hider"
            - "&7Duration: 30 seconds"
            - ""
            - "&7Cost: &6250 coins"
            - "&cTeam limit: 3"
          price: 250
          effect:
            type: "TRACKER_COMPASS"
            duration: 30
            intensity: 1.0
          restrictions:
            type: "PER_TEAM"
            max-purchases: 3
          role-filter: "SEEKER"

      settings:
        enable-statistics: true
        statistics-file: "shop-stats.csv"
        cache-gui: true
        cache-expiry-ms: 60000

      arena-overrides:
        hardcore-arena:
          item-price-multiplier: 1.5
          disabled-items:
            - "second-chance"
            - "escape-pass"
